Will use snakemake pipeline with Thu's bash code

Step 1. Preprocess raw read files-done
- FASTQC
- bbmap probably for adapter trimming (requires input for adapter sequences)
- Inputs:
    Raw fastq files, forward and reverse
- Params:
    adapter sequence fasta files
- Outputs:
    Trimmed fastq files

Step 2. Map reads to host genome with STAR, filter non-hits-done
-Inputs: 
    Trimmed fastq files, R1 and R2
-Params:
    Host+virus genome annotation file
- Outputs:
    Aligned BAM file per sample
    Mapping statistics

Step 3. Quantify the transcripts per million from the RNAseq run
-Inputs: aligned BAM files
-Params:
    Host+virus genome annotation file 
-Commands:
    Some sort of isoform quantification tool: cufflinks, HTSeq, featureCounts, RSEM etc
-Output:
    Table of expression level for all genes. 


Step 3. Separate reads into positive-sense or negative-sense reads with samtools
-Inputs:
    Aligned BAM file
-Parameters:
    
-Commands:
    For each BAM file:
        Map and extract forward strand 2nd in pair
        Map and extract reverse strand 1st in pair
        Combine above for reverse mapped reads (${FILE}_rev.bam)

        Map and extract forward strand 1st in pair
        Map and extract reverse strand 2nd in pair
        Combine above for forward mapped reads (${FILE}_fwd.bam)
-Outputs:
    Reverse mapped reads ${FILE}_rev.bam
    Forward mapped reads ${FILE}_fwd.bam


Step 4. Count reads mapped to  cRNA and mRNA at the 3â€™ end among all positive reads and calculating the fraction of cRNA and mRNA reads.
-Inputs:
    Positive strand sorted reads: ${FILE}_fwd_sort.bam <- where does this file come from? Ask Thu.
-Params:

-Commands:
    Create directory for ${FILE}_cmRNA
    Map the sorted foward bam file to each IAV segment, output to its own bam file
        e.g. samtools view ${FILE}_fwd_sort.bam EF467818.1:2325-2341  -o PB2.bam <-- for PB2 mapped reads
             samtools view ${FILE}_fwd_sort.bam EF467819.1:1001-1016  -o PB1.bam <-- for PB1 mapped reads
             etc. 
    Merge the individual mapped files together
    Index the merged files
    Use grep to find the cRNA segments from the merged bam file (looks for "AAAAACG" type pattern, 5 A's plus 2 other nucleotides)
    Use grep to find the mRNA segments from the merged files (looks for "AAAAAAA" polyA tail)
    Writes results of read counts of mRNA and cRNA to a "cmRatio.txt" file
    Calculates ratio (not in Thu's github code, but in her methods description-- awk command)

-Outputs
    "cmRatio.txt" file with table


Step 5. Calculating the ratio of spliced: unspliced isoform for alternative splicing genes (M and NS)
-Input:
    Positive strand sorted read files ${FILE}_fwd.bam

-Commands:
    samtools depth to calculate depth at specific regions of the mapped gene reads for M and NS

-Output:
    "splicing_count.txt" <-- table of read count at bases of the splice sites that can be used to calculate the fraction of M2 in total mRNA


Step 6. Calculate cRNA and mRNA expression values in transcripts per million? Unclear how this step works since I don't see code; check with Thu




Config file user-specified inputs:
-file path for adapter sequences
- path for host genome annotation file index for filtering

Dependencies:
- STAR
- SAMTOOLS
- 